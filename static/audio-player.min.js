!function (l, s, d) { "use strict"; function u(e) { return s.getElementById(e) } function f(e, t, n, a) { for (var r = t.length; r--;)e && e.addEventListener(t[r], n, a) } function y(e, t, n, a) { for (var r = t.length; r--;)e && e.removeEventListener(t[r], n, a) } function c(e, t) { try { localStorage[e] = t } catch (e) { } } function t(e, t) { try { return localStorage[e] || t } catch (e) { return t } } function n(e, t) { var n = !1; return function () { n || (e.apply(null, arguments), n = !0, setTimeout(function () { n = !1 }, t || 20)) } } function p(e) { e.preventDefault() } function h(e, t) { e.classList.remove(t) } function m(e, t) { e.classList.add(t) } function g(e, t, n) { ((n === d ? !i(e, t) : n) ? m : h)(e, t) } function i(e, t) { return e.classList.contains(t) } function v(e) { e = e && "number" == typeof e ? parseInt(e, 10) : 0; var t = Math.floor(e / 3600); e %= 3600; var n = Math.floor(e / 60), e = e % 60; return (0 !== t ? t + ":" : "") + (n < 10 ? "0" : "") + n + ":" + (e < 10 ? "0" : "") + e } var S = !1; try { var e = Object.defineProperty({}, "passive", { get: function () { S = { passive: !0 } } }); l.addEventListener("test", null, e) } catch (e) { } "requestAnimationFrame" in l || (l.requestAnimationFrame = function (e) { return setTimeout(e, 100) }); function a() { } var q, b, o, T, r, k, x, w, A, C, L, M, P, X, H, R = s.body, E = l.location && l.location.pathname ? l.location.pathname : "", F = u("player"), O = F.querySelector(".player-gui-outer"), e = F.querySelector(".player-gui"), j = e.querySelector(".play"), D = e.querySelector(".prev"), W = e.querySelector(".next"), z = e.querySelector(".backward"), B = e.querySelector(".forward"), e = F.querySelector(".player-gui-2"), I = e.querySelector(".repeat"), N = I.querySelector(".info"), Y = e.querySelector(".timer"), $ = F.querySelector(".player-gui-3").querySelector(".storyteller"), Z = F.querySelector(".now-playing"), V = F.dataset.album || "", G = F.dataset.artwork || "", J = F.dataset.artworkSize || "", K = F.querySelector(".playlist"), Q = K.querySelectorAll(".item"), U = K.querySelectorAll(".group-header"), _ = (K.querySelectorAll(".group"), !1), ee = !1, te = 0, ne = [], ae = !!F.dataset.savepesnistat, re = !!F.dataset.savestate, oe = E + "index", ie = E + "time", ce = [], ue = re ? +t(oe, 0) : 0, le = re ? +t(ie, 0) : 0, se = {}, de = 0, fe = E + "loop", ye = +t(fe, 0), pe = "playing", he = "seeking", me = F.querySelector(".progress-bar"), ge = me.querySelector(".seek-bar"), ve = me.querySelector(".play-bar"), Se = me.querySelector(".handle"), qe = me.querySelector(".current-time"), be = me.querySelector(".duration"), Te = ["click"], ke = ["selectstart"], xe = ["touchstart", "mousedown"], we = ["touchend", "mouseup"], Ae = ["touchmove", "mousemove"], e = l.navigator || {}, Ce = e.userAgent || "", Le = e.mediaSession || d, Me = d, Pe = "ontouchstart" in l || 0 < e.maxTouchPoints || 0 < e.msMaxTouchPoints, Xe = E + "/tab", He = "canplaythrough"; function Re() { !k || k.readyState < 3 || c(ie, 1 === ce.length && k.duration - k.currentTime < 5 || k.currentTime < 5 ? 0 : k.currentTime) } function Ee() { for (De(), k && 2 < k.readyState && (k.currentTime = 0), ce = [], P = 0; P < Q.length; P++)i(X = Q[P], "hidden") || ce.push(X.dataset.id); je(ue), g(W, "disabled", 1 === ce.length) } function Fe() { if (U) for (P = 0; P < U.length; P++)f(U[P], Te, function (e) { (X = K.querySelector(".g-" + this.dataset.g)).querySelector(".group-items").classList.remove("hidden"), setTimeout(function () { g(X, "closed") }, 50) }); for (P = 0; P < Q.length; P++) { (e = (X = Q[P]).dataset).f; var e, t = "//stat4.deti-online.com/s/" + e.f.replace(/[a-zA-Z]/g, function (e) { return String.fromCharCode((e <= "Z" ? 90 : 122) >= (e = e.charCodeAt(0) + 13) ? e : e - 26) }) + "." + o, n = X.querySelector(".name"); ne[e.id] = { title: n.textContent + (n.dataset.extra ? " (" + n.dataset.extra + ")" : ""), src: t }, f(X, Te, function (e) { e.preventDefault(); var t, n, a, r = e.target, o = this.dataset.id; i(r, "go-to-track") ? (t = this.querySelector("a").getAttribute("href"), re && (n = t + "index", a = t + "time", (e = r.dataset.dsttabid || !1) && (c(t + "/tab", e), c(n, 0), c(a, 0))), s.location = this.querySelector("a").getAttribute("href")) : i(r, "download") ? s.location = ne[this.dataset.id].src : o === T ? ze() : (je(ce.indexOf(o)), Ne()) }) } Ee() } function Oe() { return k && !k.paused } function je(e) { ce[e] || (le = e = 0), T !== ce[e] && (Be(), re && (c(oe, e), T === d ? qe.textContent = v(le) : c(ie, 0)), We(), k && (y(k, ["loadstart", "waiting", "ended", "pause", "playing", "timeupdate"]), M || (k.src = ""), M = !1, k = d), T = ce[ue = e], r = ne[T], (X = K.querySelector(".active")) && (h(X, "active"), X.blur()), m(K.querySelector(".item-" + T), "active"), Z.textContent = r.title) } function De() { We(), qe.textContent = "", be.textContent = "", ve.style.width = "0", Se.style.left = "0", h(F, pe) } function We() { Oe() && k.pause() } function ze() { Oe() ? k.pause() : Ne(), j.blur() } function Be() { ae && (de = 0, T && (se[T] = !1)) } function Ie() { var e, t; k && (!k.seekable || "object" == typeof k.seekable && 0 < k.seekable.length) && k.duration && (.3 * k.duration < de && !0 !== se[e = T] && (se[e] = !0, (t = l.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP")).open("POST", "/ajax/p-a-stat/" + e + "/"), t.setRequestHeader("X-Requested-With", "XMLHttpRequest"), t.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"), t.send()), de++) } function Ne() { var e; Me === d && function () { Me = !1; try { Le && null != Le.setActionHandler && (Me = !0) } catch (e) { } }(), k === d && (f(k = new Audio(r.src), ["playing"], function () { m(F, pe), h(F, he), be.textContent = v(this.duration), requestAnimationFrame(x), Ue() }), f(k, ["pause"], function () { re && Re(), h(F, pe), Ue() }), f(k, ["ended"], function () { if (M = !0, Be(), _) De(), je((ue + 1) % ce.length), te = 0, b(!(ee = _ = !1)); else switch (+ye) { case 0: ue === ce.length - 1 ? (je(0), qe.textContent = "", be.textContent = "", ve.style.width = "0", Se.style.left = "0") : $e(); break; case 1: $e(); break; case 2: k.currentTime = 0, Ne() } }), re && f(k, ["timeupdate"], n(Re, 1e3)), ae && f(k, ["timeupdate"], n(Ie, 1e3)), f(k, ["loadstart", "waiting"], function () { k && "" !== k.src && m(F, he) })), 2 < k.readyState ? Ye() : (k.load(), e = function () { Ye(), k.removeEventListener(He, e, S) }, k.addEventListener(He, e, S)) } function Ye() { k.volume = 1, 0 !== le && (k.currentTime = le, le = 0); var e = k.play(); e && "function" == typeof e.then && "function" == typeof e.catch && e.then(_e).catch(a) } function $e() { je((ue + 1) % ce.length), Ne(), W.blur() } function Ze() { k && 2 < k.readyState && (5 < k.currentTime || 1 === ce.length) ? k.currentTime = 0 : je(0 === ue ? ce.length - 1 : ue - 1), Ne(), D.blur() } function Ve() { k && (k.currentTime = Math.max(0, k.currentTime - 10), q()), z.blur() } function Ge() { k && (k.currentTime = Math.min(k.duration, k.currentTime + 10), q()), B.blur() } function Je() { function t() { switch (ye) { case 0: N.textContent = ""; break; case 1: N.textContent = "весь список"; break; case 2: N.textContent = "текущий трек" }for (P = 0; P < e.length; P++)g(X = e[P], "active", +X.dataset.value === ye) } var n = u("repeat-settings"), a = n.querySelector(".modal"), r = n.querySelector(".modal-body"), o = n.querySelector(".close-btn"), e = r.querySelectorAll(".option"), i = (F.querySelector(".info"), function (e) { a.contains(e.target) && !r.contains(e.target) && !o.contains(e.target) || setTimeout(function () { h(R, "lock"), m(n, "hidden"), y(s, Te, i) }, 150) }); for (f(I, Te, function (e) { m(R, "lock"), h(n, "hidden"), e.stopPropagation(), f(s, Te, i) }), P = 0; P < e.length; P++)f(e[P], Te, function () { var e; e = this.dataset.value, c(fe, ye = +e % 3), t() }); t() } function Ke() { function e(e, t) { if (t = !!t, e = (e = a[e] === d ? Object.keys(a)[0] : e).toString(), r !== e) { for (P = 0; P < a[r].length; P++)a[r][P].classList.add("hidden"); for (P = 0; P < a[e].length; P++)a[e][P].classList.remove("hidden"); for (P = 0; P < n.length; P++)g(X = n[P], "active", X.dataset.target === e); t || (le = ue = 0, Ee(), re && c(Xe, e)), r = e } t || function (e, t) { t = t || 600, e.style.display = "", e.style.opacity = 0; function n() { e.style.opacity = +e.style.opacity + (new Date - a) / t, a = +new Date, 1 < +e.style.opacity && (e.style.opacity = 1), +e.style.opacity < 1 && (l.requestAnimationFrame && requestAnimationFrame(n) || setTimeout(n, 16)) } var a = +new Date; n() }(K) } var n = $.querySelectorAll(".item"), a = {}, r = n[0].dataset.target; for (P = 0; P < n.length; P++)f(X = n[P], Te, function () { e(this.dataset.target), Ne() }), a[X.dataset.target] = K.querySelectorAll(".t-" + X.dataset.target); re && e(t(Xe, 1), !0) } function Qe(e, t) { Le.setActionHandler(e, function () { t() }) } function Ue() { Me && (!k || k.readyState < 3 ? Le.playbackState = "none" : Le.playbackState = Oe() ? "playing" : "paused") } function _e() { Me && T !== L && (L = T, Le.metadata ? Le.metadata.title = r.title : (Le.metadata = new MediaMetadata({ title: r.title, artist: "deti-online.com", album: V }), G && (Le.metadata.artwork = [{ src: G, sizes: J, type: "image/jpg" }])), Qe("play", Ne), Qe("pause", We), Qe("previoustrack", Ze), 1 < ce.length && Qe("nexttrack", $e)) } function et() { var a, r, o = d, i = !1; q = function () { if (k && (!k.seekable || "object" == typeof k.seekable && 0 < k.seekable.length)) { if (A) t = C * k.duration; else if ("number" != typeof (t = k.currentTime)) return; var e = v(t); e !== qe.textContent && (qe.textContent = e, b()); var t = t / k.duration * 100 || 0; ve.style.width = t + "%", Se.style.left = me.offsetWidth * t / 100 + "px" } }; var c = n(function (e) { if (A) { var t, n = e.changedTouches && e.changedTouches[0] && e.changedTouches[0].pageX ? (t = e.changedTouches[0].pageX, e.changedTouches[0].pageY) : (t = e.pageX, e.pageY); if (Pe && !i) { if (o === d) { e = Math.abs(a - t), n = Math.abs(r - n); if (e === n) return; o = n < e } if (!1 === o) return y(l, ke, p), y(l, we, u, S), y(l, Ae, c, S), A = !1, void requestAnimationFrame(x) } C = Math.min(1, Math.max(0, t - ge.getBoundingClientRect().left) / ge.offsetWidth), q() } i = !1 }, 20); function u(e) { o === d && (i = !0, c(e)), A = !1, y(l, ke, p), y(l, we, u, S), y(l, Ae, c, S), C && !isNaN(k.duration) && (k.currentTime = k.duration * C), requestAnimationFrame(x) } x = function () { w || (w = !0, q(), setTimeout(function () { w = !1, Oe() && !A && requestAnimationFrame(x) }, function (e) { try { var t = e.getBoundingClientRect(); return 0 <= t.top && 0 <= t.left && t.bottom <= (l.innerHeight || s.documentElement.clientHeight) && t.right <= (l.innerWidth || s.documentElement.clientWidth) } catch (e) { return 1 } }(ge) ? 40 : 500)) }, f(ge, xe, function (e) { !k || k.readyState < 3 || (A = !0, o = d, r = e.changedTouches && e.changedTouches[0] && e.changedTouches[0].pageX ? (a = e.changedTouches[0].pageX, e.changedTouches[0].pageY) : (a = e.pageX, e.pageY), f(l, ke, p), f(l, we, u, S), f(l, Ae, c, S)) }, S), f(l, ["resize"], q, S) } !function () { var e; try { if (!(e = "undefined" != typeof Audio ? new Audio : null) || "function" != typeof e.canPlayType) return; if (void 0 === e.oncanplaythrough && (He = "canplay"), e.muted) return } catch (e) { return } var t = e.canPlayType("audio/mpeg;").replace(/^no$/, ""), n = (r = Ce.match(/OPR\/([0-6].)/g)) && parseInt(r[0].split("/")[1], 10) < 33, a = -1 !== Ce.indexOf("Safari") && -1 === Ce.indexOf("Chrome"), r = Ce.match(/Version\/(.*?) /); if (a && r && parseInt(r[1], 10), n || !t && !e.canPlayType("audio/mp3;").replace(/^no$/, "")) if (e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, "")) o = "ogg"; else { if (!(e.canPlayType("audio/x-m4a;") || e.canPlayType("audio/m4a;") || e.canPlayType("audio/aac;")).replace(/^no$/, "")) return; o = "m4a" } else o = "mp3"; return 1 }() ? (F.innerText = "Для воспроизведения аудио необходимо установить браузер с поддержкой HTML5 Audio.", m(F, "no-solution")) : ($ && Ke(), Fe(), f(j, Te, ze), f(W, Te, function () { this.classList.contains("disabled") || $e() }), f(D, Te, function () { this.classList.contains("disabled") || Ze() }), f(B, Te, Ge), f(z, Te, Ve), et(), function () { function e() { ee && (Oe() && (_ ? te = k.duration - k.currentTime : te--, !_ && te < 1 && setTimeout(function () { ee = !1, te = 0, We(), b(!0), setTimeout(We, 1e3) }, te / 1e3)), setTimeout(e, 1e3)) } var t = u("timer-settings"), n = t.querySelector(".modal"), a = t.querySelector(".modal-body"), r = t.querySelector(".close-btn"), o = a.querySelectorAll(".option"), i = F.querySelector(".info"), c = function (e) { n.contains(e.target) && !a.contains(e.target) && !r.contains(e.target) || setTimeout(function () { h(R, "lock"), m(t, "hidden"), y(s, Te, c) }, 150) }; for (b = function (e) { (ee || e) && (e = "end" === te ? "конец трека" : v(+te), i.textContent = "00:00" === e ? "" : e) }, f(Y, Te, function (e) { m(R, "lock"), h(t, "hidden"), e.stopPropagation(), f(s, Te, c) }), P = 0; P < o.length; P++)f(o[P], Te, function () { te = this.dataset.value, b(!0), _ = "end" === te, (ee = "0" !== te) && e() }) }(), Je(), H = n(function () { var e = O.getBoundingClientRect(); g(R, "sticky-player", e.top - 46 < 0) }, 30), f(s, ["scroll"], H, S), H(), f(l, ["keydown"], function (e) { var t = !0; switch (e.keyCode) { case 32: ze(); break; case 39: Ge(); break; case 37: Ve(); break; case 78: $e(); break; case 80: Ze(); break; default: t = !1 }t && (e.stopPropagation(), e.preventDefault()) }), function () { function e(e) { var t = s.createElement("span"); t.className = "ripple", t.style.setProperty("--scale", this.offsetWidth), this.appendChild(t), setTimeout(function () { t.parentNode.removeChild(t) }, 300) } var t = s.querySelectorAll(".is-ripple"); for (P = 0; P < t.length; P++)f(t[P], we, e) }(), function e() { !0 !== l.playerCssLoaded ? setTimeout(e, 100) : h(F, "loading") }()) }(window, document);